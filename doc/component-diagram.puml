@startuml
!theme plain
skinparam componentStyle uml2

package "Сервис Pusa" {
  [Фронтенд: Thymeleaf] as Pusa_UI
  [Бэкенд: Spring Boot] as Pusa_API
}

package "Сервис Phoca" {
  [Сервер конфигурации: Spring Cloud Config] as Phoca_Config
  [gRPC API] as Phoca_gRPC
}

database "PostgreSQL" as Postgres
queue "NATS JetStream" as NATS

Pusa_UI --> Pusa_API : "HTTP (POST /policy/update)"

Pusa_API --> Phoca_Config : "HTTP (GET /pusa/default/1.0)\n[Получение конфигурации]"
Pusa_API --> Phoca_gRPC : "gRPC (UpdateConfiguration)\n[Обновление конфигурации]"
Pusa_API --> Postgres : "(БД pusa_db)"

Phoca_gRPC --> Phoca_Config : "Обновляет конфигурацию"
Phoca_Config --> Postgres : "(БД phoca_db)"
Phoca_Config --> NATS : "Публикует событие Refresh"

Pusa_API --> NATS : "Подписывается на события Refresh"

@enduml
