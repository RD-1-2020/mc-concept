# MC Concept - Configuration Management PoC

Этот проект представляет собой концепцию (Proof of Concept) системы управления конфигурацией, построенную на основе Spring Cloud Config.

## Архитектура

Система состоит из нескольких ключевых компонентов:

- **Phoca**: Сервис управления конфигурацией. Он использует Spring Cloud Config Server для хранения и предоставления конфигураций другим сервисам. Конфигурации хранятся в базе данных PostgreSQL.
- **Pusa**: Пример сервиса-потребителя конфигурации. Это веб-приложение для управления пользователями, которое получает свои настройки от `Phoca`.
- **PostgreSQL**: База данных, в которой содержатся две схемы: `phoca_db` для хранения конфигураций и `pusa_db` для хранения данных пользователей.
- **NATS**: Система обмена сообщениями, используемая для рассылки уведомлений об изменениях конфигурации через Spring Cloud Bus.
- **gRPC**: Протокол для синхронного обмена данными (запрос/ответ) между `Pusa` и `Phoca`.

Диаграмма взаимодействия:
```
[Frontend (Pusa)] <--> [Pusa Service (REST API)]
       |
       v (gRPC Call for config update)
[Phoca Service (Config Server)]
       |
       v (Stores config)
[PostgreSQL (phoca_db)]
       |
       v (Broadcasts change)
[NATS]
       |
       v (Receives notification)
[Pusa Service (Context Refresh)]
```

## Модули

Проект разделен на следующие модули:

- `phoca`: Реализация Spring Cloud Config Server. Отвечает за хранение, изменение и распространение конфигураций.
- `pusa`: Веб-приложение для управления пользователями, которое демонстрирует получение и динамическое обновление конфигурации.
- `shared`: Общий модуль, содержащий `.proto` файлы для определения gRPC сервисов и сообщений.
- `spring-cloud-bus-nats`: Кастомная реализация биндинга Spring Cloud Bus для работы с NATS.

## Запуск

Для запуска проекта используйте `docker-compose.yml` в корневой директории:
```shell
docker-compose up -d
```
Эта команда поднимет контейнеры с PostgreSQL и NATS. После этого можно запускать сервисы `phoca` и `pusa` из вашей IDE.
