# Сервис Phoca

`Phoca` — это центральный сервис управления конфигурацией. Он построен на основе `Spring Cloud Config Server` и отвечает за хранение, версионирование и предоставление конфигураций для всех микросервисов в системе.

## Основные функции

1.  **Предоставление конфигураций (Read)**: `Phoca` обслуживает стандартные HTTP-запросы от клиентов Spring Cloud Config (например, `Pusa`) для получения их наборов свойств.
2.  **Хранение конфигураций**: В качестве бэкенда используется база данных PostgreSQL (схема `phoca_db`), что настраивается через профиль `jdbc`.
3.  **Обновление конфигураций (Write)**: Предоставляет gRPC API (`UpdateConfiguration`) для внешних систем, позволяя им изменять значения отдельных свойств.
4.  **Рассылка уведомлений**: После изменения конфигурации через gRPC, `Phoca` отправляет событие `RefreshRemoteApplicationEvent` в NATS, чтобы оповестить все заинтересованные сервисы.

## Технологический стек

- **Spring Boot**: Основа приложения.
- **Spring Cloud Config Server**: Ядро сервиса.
- **JDBC / Liquibase**: Для работы с базой данных конфигураций в PostgreSQL.
- **Spring Cloud Bus**: Для интеграции с NATS.
- **gRPC Server**: Для предоставления API для управления конфигурацией.

## Взаимодействие

- **Чтение конфигурации**: Клиенты (микросервисы) при старте или при получении Refresh-события запрашивают свою конфигурацию по стандартному REST API Spring Cloud Config (`/{application}/{profile}/{label}`).
- **Запись конфигурации**:
    1.  Внешний сервис (например, `Pusa`) вызывает gRPC метод `UpdateConfiguration`.
    2.  `Phoca` напрямую обновляет значение в своей базе данных через JDBC.
    3.  `Phoca` публикует событие `RefreshRemoteApplicationEvent` в NATS с указанием сервиса, чья конфигурация была затронута.
